<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bar & Panini - Cassa Touch</title>
<style>
body {
  margin:0;
  font-family:'Arial',sans-serif;
  background:#f0f2f5;
  display:flex;
  justify-content:center;
  padding:20px;
}
.app {
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  max-width:1400px;
  width:100%;
}
.menu, .cart {
  background:#fff;
  border-radius:20px;
  padding:25px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}
.menu { flex:1 1 650px; }
.cart { flex:1 1 550px; display:flex; flex-direction:column; position:relative; }
h2 { margin-top:0; color:#ff6b35; font-weight:bold; font-size:1.8em; }
.section-title { margin-top:15px; font-size:1.3em; font-weight:bold; color:#333; }
.product {
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#fafafa;
  padding:15px;
  margin-bottom:12px;
  border-radius:15px;
  border:1px solid #eee;
  cursor:pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.product:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.15); }
.btn {
  background:#ff6b35;
  border:none;
  padding:10px 14px;
  border-radius:10px;
  color:#fff;
  cursor:pointer;
  transition:0.2s;
  font-size:0.95em;
}
.btn:hover { background:#ff4f10; }
.item-row {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
  border-bottom:1px dashed #ddd;
  padding-bottom:6px;
}
.receipt {
  background:#fafafa;
  padding:15px;
  border-radius:15px;
  margin-top:12px;
  font-family:monospace;
  white-space:pre-wrap;
  border:1px solid #ddd;
  word-wrap: break-word;
}
.chip {
  display:inline-block;
  padding:6px 12px;
  margin:4px;
  border-radius:20px;
  border:1px solid #ccc;
  cursor:pointer;
  user-select:none;
  transition:0.2s;
}
.chip.selected { background:#ff6b35; color:#fff; border-color:#ff6b35; }
input[type=number] { width:60px; padding:6px; border-radius:6px; border:1px solid #ccc; font-size:1em; }
#numPad { display:none; margin-top:10px;}
#numPad button { width:60px;height:60px;margin:5px; font-size:1.3em; border-radius:10px; border:none; background:#ff6b35;color:#fff; cursor:pointer; }
#numPad button:hover { background:#ff4f10; }

/* Pulsanti Reset fissi in basso */
.reset-section {
  display:flex;
  flex-direction:column;
  gap:5px;
  position:sticky;
  bottom:10px;
  margin-top:15px;
}
.reset-section .btn { width:100%; }

@media (max-width:1024px){
  .app { flex-direction:column; align-items:center; }
  .menu, .cart { flex:1 1 100%; max-width:95%; }
}
</style>
</head>
<body>
<div class="app">

<!-- MENU -->
<div class="menu">
  <h2>Menu</h2>

  <div class="section-title">‚òï Colazione</div>
  <div class="product" data-name="Caff√®" data-price="1">Caff√® 1,00 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>
  <div class="product" data-name="Cappuccino" data-price="1.5">Cappuccino 1,50 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>
  <div class="product" data-name="Brioches" data-price="1.2">Brioches 1,20 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>

  <div class="section-title">üçπ Bevande e Snack</div>
  <div class="product" data-name="Bibita" data-price="2.5">Bibita 2,50 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>
  <div class="product" data-name="Birra" data-price="3">Birra 3,00 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>

  <div class="section-title">üçî Panini</div>
  <div class="product" id="paninoRow">Aggiungi Panino <button class="btn" id="personalizzaBtn">Personalizza</button></div>
  <div id="paninoOptions" style="display:none; margin-top:10px;">
    <div><strong>Tipo carne:</strong></div>
    <div>
      <span class="chip" data-meat="Salamella">Salamella</span>
      <span class="chip" data-meat="Wurstel">Wurstel</span>
      <span class="chip" data-meat="Porchetta">Porchetta</span>
    </div>
    <div><strong>Ingredienti:</strong></div>
    <div>
      <span class="chip" data-ing="Crauti">Crauti</span>
      <span class="chip" data-ing="Cipolle">Cipolle</span>
      <span class="chip" data-ing="Senape">Senape</span>
      <span class="chip" data-ing="Maionese">Maionese</span>
      <span class="chip" data-ing="Ketchup">Ketchup</span>
    </div>
    <div style="margin-top:10px;">
      Quantit√†: <input type="number" id="panQty" value="1" min="1">
      <button class="btn" id="addPanBtn">Aggiungi Panino</button>
      <button class="btn" id="completePanBtn">Completo</button>
      <button class="btn" id="closePanBtn">Chiudi</button>
    </div>
  </div>

  <div class="section-title">‚ú® Extra</div>
  <div class="product" data-name="Prodotto1" data-price="0.00">Prodotto 1 0,00 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>
  <div class="product" data-name="Prodotto2" data-price="0.00">Prodotto 2 0,00 ‚Ç¨<button class="btn addBtn">Aggiungi</button></div>
</div>

<!-- CARRELLO -->
<div class="cart">
  <h2>Carrello</h2>
  <div id="cartItems"></div>
  <div style="margin-top:10px;">
    <strong>Totale: </strong><span id="totalAmount">0,00 ‚Ç¨</span>
  </div>
  <div style="margin-top:10px;">
    Contanti dal cliente: <input type="text" id="cashGiven" readonly>
    <button class="btn" id="showNumPad">Calcola resto</button>
    <div id="numPad">
      <div><button class="numBtn">1</button><button class="numBtn">2</button><button class="numBtn">3</button></div>
      <div><button class="numBtn">4</button><button class="numBtn">5</button><button class="numBtn">6</button></div>
      <div><button class="numBtn">7</button><button class="numBtn">8</button><button class="numBtn">9</button></div>
      <div><button class="numBtn">0</button><button class="numBtn">,</button></div>
      <button class="btn" id="numClear">C</button>
      <button class="btn" id="numEnter">OK</button>
    </div>
    <div>Resto: <span id="changeAmount">0,00 ‚Ç¨</span></div>
  </div>

  <button class="btn" id="printBtn" style="margin-top:10px;">üíµ Paga Contanti</button>
  <button class="btn" id="paySatispay" style="margin-top:5px; background:#e60019;">üí≥ Paga Satispay</button>
  <button class="btn" id="dayTotalBtn" style="margin-top:10px; background:#28a745;">üí∞ Totale Giornata</button>
  <div class="receipt" id="receiptPreview">Scontrino in anteprima...</div>

  <div class="reset-section">
    <button class="btn" id="resetCash" style="background:#ff9900;">Reset Totale Contanti</button>
    <button class="btn" id="resetSatispay" style="background:#9900ff;">Reset Totale Satispay</button>
    <button class="btn" id="clearCartBtn" style="background:#555;">Svuota Carrello</button>
  </div>
</div>

<script>
let cart=[]; 
let totalCash=0; 
let totalSatispay=0;

function formatMoney(v){
  return v.toFixed(2).replace('.',',')+' ‚Ç¨';
}

function renderCart(){
  const cartItems=document.getElementById('cartItems'); 
  cartItems.innerHTML='';
  let grouped={}; 

  cart.forEach(item=>{
    const key=item.name+(item.meta?item.meta.join(','):'' );
    if(grouped[key]) grouped[key].qty+=item.qty;
    else grouped[key]={...item};
  });

  Object.values(grouped).forEach(item=>{
    const div=document.createElement('div'); 
    div.className='item-row';
    div.innerHTML=`
      ${item.qty} x ${item.name}${item.meta? ' ('+item.meta.join(', ')+')':''} - ${formatMoney(item.price*item.qty)}
      <button onclick="removeItem('${item.name}','${item.meta?item.meta.join(','):""}')" 
              class="btn" style="padding:2px 6px; margin-left:5px;">‚úñ</button>`;
    cartItems.appendChild(div);
  });

  document.getElementById('totalAmount').innerText=
    formatMoney(cart.reduce((a,b)=>a+b.price*b.qty,0));

  updateReceipt();
}

function addToCart(item){
  cart.push(item);
  renderCart();
}

function removeItem(name,meta){
  for(let i=0;i<cart.length;i++){
    const item=cart[i];
    if(item.name===name && ((item.meta?item.meta.join(','):'')===meta)){
      cart.splice(i,1);
      break;
    }
  }
  renderCart();
}

function clearCart(){
  cart=[];
  renderCart();
}

function updateReceipt(){
  let text='BAR & PANINI\nüìç Cuneo, Piccapietra\n-----------------------------\n';
  let grouped={};

  cart.forEach(item=>{
    const key=item.name+(item.meta?item.meta.join(','):'' );
    if(grouped[key]) grouped[key].qty+=item.qty; 
    else grouped[key]={...item};
  });

  Object.values(grouped).forEach(item=>{
    if(item.name.toLowerCase().includes('birra') && item.qty>=10){
      text+=item.qty+' x '+item.name+' cumulabili\n';
    } else {
      text+=item.qty+' x '+item.name+'\n';
    }
    if(item.meta) text+=item.meta.join(', ')+'\n';
    text+='  '+formatMoney(item.price*item.qty)+'\n';
  });

  text+='-----------------------------\nTotale: '+formatMoney(cart.reduce((a,b)=>a+b.price*b.qty,0))+'\n';

  document.getElementById('receiptPreview').innerText=text;
}

// Prodotti base
document.querySelectorAll('.addBtn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    const prod=e.target.closest('.product');
    const name=prod.dataset.name;
    const price=parseFloat(prod.dataset.price);
    addToCart({name:name,price:price,qty:1});
  });
});

// Panino
const personalizzaBtn=document.getElementById('personalizzaBtn'); 
const panOptions=document.getElementById('paninoOptions');
const addPanBtn=document.getElementById('addPanBtn'); 
const closePanBtn=document.getElementById('closePanBtn');
const completePanBtn=document.getElementById('completePanBtn');

personalizzaBtn.addEventListener('click',()=>{
  panOptions.style.display='block';
});
closePanBtn.addEventListener('click',()=>{
  panOptions.style.display='none';
});

addPanBtn.addEventListener('click',()=>{
  const qty=parseInt(document.getElementById('panQty').value);
  const meat=Array.from(document.querySelectorAll('#paninoOptions .chip[data-meat].selected'))
                  .map(x=>x.dataset.meat)[0];
  if(!meat){ alert('Seleziona il tipo di carne!'); return; }
  const ingredients=Array.from(document.querySelectorAll('#paninoOptions .chip[data-ing].selected'))
                        .map(x=>x.dataset.ing);
  const name='Panino '+meat;
  addToCart({name:name, price:6, qty:qty, meta:ingredients.length?ingredients:null});
  panOptions.style.display='none';
  document.getElementById('panQty').value=1;
  document.querySelectorAll('#paninoOptions .chip').forEach(c=>c.classList.remove('selected'));
});

completePanBtn.addEventListener('click',()=>{
  const qty=parseInt(document.getElementById('panQty').value);
  const meat=Array.from(document.querySelectorAll('#paninoOptions .chip[data-meat].selected'))
                  .map(x=>x.dataset.meat)[0];
  if(!meat){ alert('Seleziona il tipo di carne!'); return; }

  let ingredients=[];
  if(meat==="Salamella") ingredients=["Crauti","Senape"];
  else if(meat==="Wurstel") ingredients=["Ketchup","Senape"];
  else if(meat==="Porchetta") ingredients=["Cipolle","Maionese"];

  const name='Panino '+meat+' (Completo)';
  addToCart({name:name, price:6, qty:qty, meta:ingredients});
  panOptions.style.display='none';
  document.getElementById('panQty').value=1;
  document.querySelectorAll('#paninoOptions .chip').forEach(c=>c.classList.remove('selected'));
});

// Selezione chip
document.querySelectorAll('#paninoOptions .chip').forEach(c=>{
  c.addEventListener('click',()=>{
    if(c.dataset.meat){
      document.querySelectorAll('#paninoOptions .chip[data-meat]')
        .forEach(x=>x.classList.remove('selected'));
      c.classList.add('selected');
    } else {
      c.classList.toggle('selected');
    }
  });
});

// Tastiera numerica
const numPad=document.getElementById('numPad');
const cashInput=document.getElementById('cashGiven');

document.getElementById('showNumPad').addEventListener('click',()=>{
  numPad.style.display='block';
});

document.querySelectorAll('.numBtn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    cashInput.value+=(btn.innerText===','?'.':btn.innerText);
  });
});

document.getElementById('numClear').addEventListener('click',()=>{
  cashInput.value='';
});

document.getElementById('numEnter').addEventListener('click',()=>{
  numPad.style.display='none';
  let cash=parseFloat(cashInput.value.replace(',', '.'))||0;
  const total=cart.reduce((a,b)=>a+b.price*b.qty,0);
  const change=cash-total;

  if(change<0){ alert('Soldi insufficienti!'); return; }

  document.getElementById('changeAmount').innerText=formatMoney(change);
});

// Scontrino
function stampaScontrino(metodo){
  let text='BAR & PANINI\nüìç Cuneo, Piccapietra\n-----------------------------\n';
  let grouped={};

  cart.forEach(item=>{
    const key=item.name+(item.meta?item.meta.join(','):'' );
    if(grouped[key]) grouped[key].qty+=item.qty; 
    else grouped[key]={...item};
  });

  Object.values(grouped).forEach(item=>{
    if(item.name.toLowerCase().includes('birra') && item.qty>=10){
      text+=item.qty+' x '+item.name+' cumulabili\n';
    } else {
      text+=item.qty+' x '+item.name+'\n';
    }
    if(item.meta) text+=item.meta.join(', ')+'\n';
    text+='  '+formatMoney(item.price*item.qty)+'\n';
  });

  let total=cart.reduce((a,b)=>a+b.price*b.qty,0);
  text+='-----------------------------\nTotale: '+formatMoney(total)+'\nPagamento: '+metodo.toUpperCase()+'\n\nGrazie e Buon Torneo!\n';

  const win=window.open('','_blank','width=300,height=600');
  win.document.write('<pre style="font-family:monospace; font-size:12px; line-height:1.2;">'+text+'</pre>');
  win.document.close();
  win.print();

  if(metodo==="contanti") totalCash+=total; 
  else if(metodo==="satispay") totalSatispay+=total;

  cart=[]; 
  renderCart(); 
  cashInput.value=''; 
  document.getElementById('changeAmount').innerText=formatMoney(0);
}

document.getElementById('printBtn').addEventListener('click',()=>stampaScontrino('contanti'));
document.getElementById('paySatispay').addEventListener('click',()=>stampaScontrino('satispay'));
document.getElementById('dayTotalBtn').addEventListener('click',()=>{
  alert('Totale Contanti: '+formatMoney(totalCash)+'\nTotale Satispay: '+formatMoney(totalSatispay));
});


// ‚≠ê‚≠ê‚≠ê PIN DI SICUREZZA ‚≠ê‚≠ê‚≠ê
function askPin(callback){
  const pin = prompt("Inserisci PIN per confermare il reset:");
  if(pin === "1234") callback();
  else alert("PIN errato!");
}

// Reset con PIN
document.getElementById('resetCash').addEventListener('click',()=>{
  askPin(()=>{
    totalCash=0; 
    alert('Totale contanti azzerato');
  });
});

document.getElementById('resetSatispay').addEventListener('click',()=>{
  askPin(()=>{
    totalSatispay=0; 
    alert('Totale Satispay azzerato');
  });
});

document.getElementById('clearCartBtn').addEventListener('click',()=>{ clearCart(); });
</script>

</body>
</html>
